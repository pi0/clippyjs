<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ“Ž Clippy - Windows 98</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: "MS Sans Serif", "Microsoft Sans Serif", Tahoma, Geneva, sans-serif;
        font-size: 11px;
      }

      /* -- Win98 Desktop -- */
      .win98-desktop {
        width: 100%;
        height: 100%;
        background: #008080;
        display: flex;
        flex-direction: column;
      }

      /* -- Desktop area -- */
      .desktop-area {
        flex: 1;
        padding: 16px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        align-content: flex-start;
        gap: 8px;
      }

      /* -- Desktop icons -- */
      .desktop-icon {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 72px;
        padding: 4px;
        cursor: default;
        user-select: none;
        text-align: center;
      }

      .desktop-icon:focus,
      .desktop-icon:active {
        outline: 1px dotted #fff;
      }

      .desktop-icon:active .icon-label {
        background: #000080;
        color: #fff;
      }

      .icon-img {
        width: 32px;
        height: 32px;
        image-rendering: pixelated;
        margin-bottom: 2px;
      }

      .icon-label {
        color: #fff;
        text-shadow: 1px 1px 1px #000;
        padding: 1px 2px;
        line-height: 1.3;
        word-break: break-word;
      }

      /* -- Win98 Window -- */
      .win98-window {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        cursor: default;
        width: 420px;
        max-width: calc(100vw - 16px);
        background: #c0c0c0;
        border-top: 2px solid #fff;
        border-left: 2px solid #fff;
        border-right: 2px solid #404040;
        border-bottom: 2px solid #404040;
        box-shadow:
          inset 1px 1px 0 #dfdfdf,
          inset -1px -1px 0 #808080;
      }

      .win98-titlebar {
        background: linear-gradient(90deg, #000080, #1084d0);
        color: #fff;
        font-weight: bold;
        font-size: 11px;
        padding: 3px 4px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        user-select: none;
      }

      .titlebar-text {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .titlebar-buttons {
        display: flex;
        gap: 2px;
      }

      .titlebar-btn {
        width: 16px;
        height: 14px;
        background: #c0c0c0;
        border-top: 1px solid #fff;
        border-left: 1px solid #fff;
        border-right: 1px solid #404040;
        border-bottom: 1px solid #404040;
        font-size: 9px;
        line-height: 12px;
        text-align: center;
        cursor: default;
        color: #000;
        font-family: "Marlett", sans-serif;
      }

      .titlebar-btn:active {
        border-top: 1px solid #404040;
        border-left: 1px solid #404040;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #fff;
      }

      .win98-body {
        padding: 12px;
      }

      .win98-body p {
        font-size: 11px;
        line-height: 1.5;
        color: #000;
      }

      .win98-body h2 {
        font-size: 13px;
        font-weight: bold;
        margin-bottom: 8px;
      }

      /* Agent select */
      .agent-select-group {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }

      .agent-btn {
        background: #c0c0c0;
        border-top: 2px solid #fff;
        border-left: 2px solid #fff;
        border-right: 2px solid #404040;
        border-bottom: 2px solid #404040;
        padding: 3px 10px;
        font-family: inherit;
        font-size: 11px;
        color: #000;
        cursor: default;
        min-height: 32px;
      }

      .agent-btn:active,
      .agent-btn.active {
        border-top: 2px solid #404040;
        border-left: 2px solid #404040;
        border-right: 2px solid #fff;
        border-bottom: 2px solid #fff;
        padding: 4px 9px 2px 11px;
      }

      .agent-btn:focus {
        outline: 1px dotted #000;
        outline-offset: -4px;
      }

      /* -- Win98 Checkbox toggle -- */
      .win98-checkbox {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 10px;
        cursor: default;
        user-select: none;
      }

      .win98-checkbox input[type="checkbox"] {
        appearance: none;
        -webkit-appearance: none;
        width: 13px;
        height: 13px;
        background: #fff;
        border-top: 1px solid #808080;
        border-left: 1px solid #808080;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #fff;
        box-shadow: inset 1px 1px 0 #404040;
        cursor: default;
        position: relative;
        flex-shrink: 0;
        margin: 0;
      }

      .win98-checkbox input[type="checkbox"]:focus {
        outline: 1px dotted #000;
        outline-offset: 1px;
      }

      .win98-checkbox input[type="checkbox"]:checked::after {
        content: "âœ“";
        position: absolute;
        top: -2px;
        left: 1px;
        font-size: 12px;
        font-weight: bold;
        color: #000;
        line-height: 1;
      }

      .win98-checkbox input[type="checkbox"]:disabled {
        background: #c0c0c0;
      }

      .win98-checkbox input[type="checkbox"]:disabled::after {
        color: #808080;
      }

      .win98-checkbox label {
        font-size: 11px;
        cursor: default;
      }

      .win98-checkbox label.disabled {
        color: #808080;
      }

      /* -- Win98 Dropdown / Combobox -- */
      .anim-select-group {
        margin-top: 10px;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .anim-select-group label {
        font-size: 11px;
        white-space: nowrap;
        margin-right: 2px;
      }

      .win98-select {
        flex: 1;
        min-width: 0;
        height: 21px;
        background: #fff;
        border-top: 1px solid #808080;
        border-left: 1px solid #808080;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #fff;
        box-shadow: inset 1px 1px 0 #404040;
        font-family: inherit;
        font-size: 11px;
        color: #000;
        padding: 0 2px;
        cursor: default;
        appearance: none;
        -webkit-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16'%3E%3Crect width='16' height='16' fill='%23c0c0c0'/%3E%3Crect x='0' y='0' width='15' height='15' fill='%23fff' /%3E%3Crect x='1' y='1' width='14' height='14' fill='%23808080' /%3E%3Crect x='1' y='1' width='13' height='13' fill='%23c0c0c0' /%3E%3Cpolygon points='4,5 12,5 8,11' fill='%23000'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0 center;
        background-size: 16px 16px;
        padding-right: 18px;
      }

      .win98-select:focus {
        outline: none;
      }

      .win98-select:disabled {
        background-color: #c0c0c0;
        color: #808080;
      }

      /* -- Status bar -- */
      .win98-statusbar {
        border-top: 1px solid #808080;
        padding: 2px 6px;
        font-size: 11px;
        color: #000;
        display: flex;
        gap: 8px;
      }

      .statusbar-section {
        border-top: 1px solid #fff;
        border-left: 1px solid #808080;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #808080;
        padding: 1px 4px;
        flex: 1;
      }

      /* -- Taskbar -- */
      .win98-taskbar {
        height: 30px;
        background: #c0c0c0;
        border-top: 2px solid #fff;
        display: flex;
        align-items: center;
        padding: 2px 4px;
        gap: 4px;
        z-index: 9999;
      }

      .start-btn {
        display: flex;
        align-items: center;
        gap: 3px;
        height: 22px;
        padding: 0 6px;
        background: #c0c0c0;
        border-top: 2px solid #fff;
        border-left: 2px solid #fff;
        border-right: 2px solid #404040;
        border-bottom: 2px solid #404040;
        font-family: inherit;
        font-size: 11px;
        font-weight: bold;
        color: #000;
        cursor: default;
      }

      .start-btn:active {
        border-top: 2px solid #404040;
        border-left: 2px solid #404040;
        border-right: 2px solid #fff;
        border-bottom: 2px solid #fff;
      }

      .start-logo {
        width: 14px;
        height: 14px;
      }

      .taskbar-tray {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 6px;
        height: 22px;
        padding: 0 8px;
        border-top: 1px solid #808080;
        border-left: 1px solid #808080;
        border-right: 1px solid #fff;
        border-bottom: 1px solid #fff;
        font-size: 11px;
      }

      /* Win98 4-color flag as inline SVG */
      .win98-flag {
        display: inline-block;
        width: 14px;
        height: 14px;
      }

      /* -- Notification balloon (Win98 tray style) -- */
      .tray-notification {
        position: absolute;
        bottom: 34px;
        right: 8px;
        width: 260px;
        background: #ffffe1;
        border: 1px solid #000;
        box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        font-size: 11px;
        z-index: 10000;
        animation: notif-fadein 0.3s ease;
        cursor: default;
      }

      .tray-notification::before {
        content: "";
        position: absolute;
        bottom: -6px;
        right: 20px;
        width: 10px;
        height: 6px;
        background: #ffffe1;
        clip-path: polygon(0 0, 100% 0, 50% 100%);
        border-left: 1px solid #000;
        border-right: 1px solid #000;
      }

      .notif-header {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 8px 2px;
        font-weight: bold;
      }

      .notif-body {
        padding: 2px 8px 8px;
        line-height: 1.5;
      }

      .notif-body a {
        color: #0000ff;
        text-decoration: underline;
      }

      .notif-body a:visited {
        color: #800080;
      }

      .notif-body a:hover {
        color: #ff0000;
      }

      .notif-close {
        margin-left: auto;
        background: none;
        border: none;
        font-size: 11px;
        font-family: inherit;
        cursor: default;
        color: #000;
        padding: 0 2px;
      }

      .notif-close:hover {
        color: #ff0000;
      }

      @keyframes notif-fadein {
        from {
          opacity: 0;
          transform: translateY(4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Mobile adjustments */
      @media (max-width: 480px) {
        .desktop-area {
          padding: 10px;
          gap: 4px;
        }

        .win98-body {
          padding: 10px;
        }

        .win98-body p {
          font-size: 13px;
        }

        .win98-body h2 {
          font-size: 15px;
        }

        .agent-btn {
          font-size: 13px;
          padding: 6px 12px;
          min-height: 36px;
        }

        .agent-btn:active,
        .agent-btn.active {
          padding: 7px 11px 5px 13px;
        }

        .agent-select-group {
          gap: 6px;
        }

        .win98-checkbox label {
          font-size: 13px;
        }

        .anim-select-group label {
          font-size: 13px;
        }

        .win98-select {
          height: 28px;
          font-size: 13px;
        }

        .win98-taskbar {
          height: 36px;
        }

        .start-btn {
          height: 28px;
          font-size: 13px;
        }

        .taskbar-tray {
          height: 28px;
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <div class="win98-desktop">
      <!-- Desktop icons -->
      <div class="desktop-area">
        <div class="desktop-icon" tabindex="0">
          <svg class="icon-img" viewBox="0 0 32 32">
            <rect x="4" y="2" width="24" height="28" fill="#fff" stroke="#000" stroke-width="1" />
            <rect x="4" y="2" width="24" height="6" fill="#000080" />
            <text x="16" y="7" text-anchor="middle" fill="#fff" font-size="5" font-weight="bold">
              README
            </text>
            <line x1="8" y1="13" x2="24" y2="13" stroke="#000" stroke-width="0.5" />
            <line x1="8" y1="16" x2="24" y2="16" stroke="#000" stroke-width="0.5" />
            <line x1="8" y1="19" x2="20" y2="19" stroke="#000" stroke-width="0.5" />
            <line x1="8" y1="22" x2="22" y2="22" stroke="#000" stroke-width="0.5" />
          </svg>
          <span class="icon-label">README.txt</span>
        </div>
        <div class="desktop-icon" tabindex="0">
          <svg class="icon-img" viewBox="0 0 32 32">
            <rect
              x="2"
              y="6"
              width="28"
              height="22"
              rx="1"
              fill="#c0c000"
              stroke="#808000"
              stroke-width="1"
            />
            <rect
              x="2"
              y="2"
              width="14"
              height="6"
              rx="1"
              fill="#c0c000"
              stroke="#808000"
              stroke-width="1"
            />
            <rect
              x="4"
              y="10"
              width="24"
              height="16"
              fill="#ffff80"
              stroke="#808000"
              stroke-width="0.5"
            />
          </svg>
          <span class="icon-label">My Agents</span>
        </div>
        <div class="desktop-icon" tabindex="0">
          <svg class="icon-img" viewBox="0 0 32 32">
            <rect
              x="2"
              y="4"
              width="28"
              height="24"
              rx="2"
              fill="#c0c0c0"
              stroke="#808080"
              stroke-width="1"
            />
            <rect x="4" y="6" width="24" height="16" fill="#008080" />
            <circle cx="16" cy="14" r="5" fill="#fff" opacity="0.3" />
            <rect x="8" y="24" width="16" height="2" rx="1" fill="#808080" />
          </svg>
          <span class="icon-label">My Computer</span>
        </div>
      </div>

      <!-- Win98 Window -->
      <div class="win98-window">
        <div class="win98-titlebar">
          <span class="titlebar-text">
            <svg width="14" height="14" viewBox="0 0 16 16">
              <circle cx="8" cy="8" r="7" fill="#ffcc00" stroke="#806600" stroke-width="1" />
              <circle cx="6" cy="6" r="1.5" fill="#000" />
              <circle cx="10" cy="6" r="1.5" fill="#000" />
              <path d="M5 10 Q8 13 11 10" fill="none" stroke="#000" stroke-width="1" />
            </svg>
            Clippy.js â€” Agent Loader
          </span>
          <div class="titlebar-buttons">
            <button class="titlebar-btn">_</button>
            <button class="titlebar-btn">â–¡</button>
            <button class="titlebar-btn">Ã—</button>
          </div>
        </div>
        <div class="win98-body">
          <h2>Welcome to Clippy.js!</h2>
          <p>
            Click an agent below to summon your desktop assistant.<br />They will wander around and
            say hello.
          </p>
          <div class="agent-select-group" id="agent-buttons"></div>
          <div class="anim-select-group">
            <label for="anim-select">Animation:</label>
            <select class="win98-select" id="anim-select" disabled>
              <option>â€”</option>
            </select>
          </div>
          <div class="win98-checkbox">
            <input type="checkbox" id="tts-toggle" checked />
            <label for="tts-toggle">Enable text-to-speech</label>
          </div>
        </div>
        <div class="win98-statusbar">
          <span class="statusbar-section" id="status-text">Ready</span>
          <span class="statusbar-section" style="flex: 0; white-space: nowrap" id="agent-count"
            >0 agents</span
          >
        </div>
      </div>

      <!-- Taskbar -->
      <div class="win98-taskbar">
        <button class="start-btn">
          <svg class="start-logo" viewBox="0 0 16 16">
            <rect x="1" y="1" width="6" height="6" fill="#f00" />
            <rect x="9" y="1" width="6" height="6" fill="#0f0" />
            <rect x="1" y="9" width="6" height="6" fill="#00f" />
            <rect x="9" y="9" width="6" height="6" fill="#ff0" />
          </svg>
          Start
        </button>
        <div class="taskbar-tray">
          <!-- GitHub tray icon -->
          <span
            id="gh-tray-icon"
            title="GitHub"
            style="cursor: default; display: flex; align-items: center"
          >
            <svg width="14" height="14" viewBox="0 0 16 16" style="image-rendering: pixelated">
              <circle cx="8" cy="8" r="7" fill="#000" stroke="#808080" stroke-width="0.5" />
              <path
                d="M8 2.5C4.7 2.5 2 5.1 2 8.3c0 2.6 1.7 4.7 4 5.5.3.1.4-.1.4-.3v-1c-1.6.4-2-.8-2-.8-.3-.7-.7-.9-.7-.9-.5-.4 0-.4 0-.4.6 0 .9.6.9.6.5.9 1.4.6 1.7.5.1-.4.2-.6.4-.8-1.3-.1-2.7-.6-2.7-2.8 0-.6.2-1.1.6-1.5-.1-.1-.3-.7.1-1.5 0 0 .5-.2 1.5.6.5-.1.9-.2 1.4-.2s1 .1 1.4.2c1.1-.8 1.5-.6 1.5-.6.3.8.1 1.4.1 1.5.4.4.6.9.6 1.5 0 2.2-1.4 2.7-2.7 2.8.2.2.4.5.4 1.1v1.6c0 .2.1.4.4.3 2.3-.8 4-2.9 4-5.5C14 5.1 11.3 2.5 8 2.5z"
                fill="#fff"
              />
            </svg>
          </span>
          <!-- Notification balloon -->
          <div class="tray-notification" id="gh-notification">
            <div class="notif-header">
              <svg width="12" height="12" viewBox="0 0 16 16">
                <circle cx="8" cy="8" r="7" fill="#0000aa" />
                <text
                  x="8"
                  y="12"
                  text-anchor="middle"
                  fill="#fff"
                  font-size="11"
                  font-weight="bold"
                >
                  i
                </text>
              </svg>
              ClippyJS on GitHub
              <button class="notif-close" id="notif-close-btn">Ã—</button>
            </div>
            <div class="notif-body">
              View source code, report issues, and contribute on GitHub:<br />
              <a href="https://github.com/pi0/clippyjs" target="_blank">github.com/pi0/clippyjs</a>
            </div>
          </div>
          <span id="clock"></span>
        </div>
      </div>
    </div>

    <script type="module">
      import { initAgent } from "./src/index.ts";
      import * as agents from "./src/agents/index.ts";

      const availableAgents = Object.keys(agents);

      const talks = [
        "How can I help you?",
        "Nice day!",
        "Glad to meet you.",
        "At your service!",
        "Helloo!",
        "Welcome!\nI'm here to help you\nwith anything you need.",
      ];

      let currentAgent = null;
      let currentIntervals = [];
      let activeBtn = null;
      const statusText = document.getElementById("status-text");
      const agentCount = document.getElementById("agent-count");
      const btnContainer = document.getElementById("agent-buttons");
      const ttsToggle = document.getElementById("tts-toggle");
      const ttsLabel = document.querySelector('label[for="tts-toggle"]');
      const animSelect = document.getElementById("anim-select");
      const ttsSupported = "speechSynthesis" in window;
      if (!ttsSupported) {
        ttsToggle.checked = false;
        ttsToggle.disabled = true;
        ttsLabel.classList.add("disabled");
        ttsLabel.textContent = "Text-to-speech (not supported)";
      }

      // Build agent buttons
      const buttons = new Map();
      for (const name of availableAgents) {
        const btn = document.createElement("button");
        btn.className = "agent-btn";
        btn.textContent = name;
        btn.addEventListener("click", () => loadAgent(name, btn));
        btnContainer.appendChild(btn);
        buttons.set(name, btn);
      }

      // Load agent from URL hash or pick a random one
      const hashAgent = location.hash.slice(1);
      const randomAgent = availableAgents[~~(Math.random() * availableAgents.length)];
      const initialAgent = !hashAgent
        ? randomAgent
        : availableAgents.includes(hashAgent)
          ? hashAgent
          : randomAgent;
      const isRandom = !hashAgent;
      loadAgent(initialAgent, buttons.get(initialAgent), { updateHash: !isRandom });

      async function loadAgent(name, btn, { updateHash = true } = {}) {
        if (activeBtn === btn) return;

        // Persist selection in URL
        if (updateHash) history.replaceState(null, "", "#" + name);

        // Remove previous agent
        if (currentAgent) {
          currentAgent.dispose();
          for (const id of currentIntervals) clearInterval(id);
          currentIntervals = [];
        }
        if (activeBtn) {
          activeBtn.classList.remove("active");
          activeBtn.disabled = false;
        }

        btn.classList.add("active");
        btn.disabled = true;
        activeBtn = btn;
        statusText.textContent = "Loading " + name + "...";

        const agent = await initAgent(agents[name]);

        // If another agent was selected while loading, bail out
        if (activeBtn !== btn) {
          agent.dispose();
          return;
        }
        currentAgent = agent;
        agentCount.textContent = "1 agent";
        statusText.textContent = name + " loaded!";

        agent.show();

        // Populate animation dropdown
        animSelect.innerHTML = "";
        const anims = agent.animations().sort();
        for (const anim of anims) {
          const opt = document.createElement("option");
          opt.value = anim;
          opt.textContent = anim;
          animSelect.appendChild(opt);
        }
        animSelect.disabled = false;

        const speak = () => {
          agent.speak("I am " + name + ". " + talks[~~(Math.random() * talks.length)], {
            tts: ttsToggle.checked,
          });
          agent.animate();
        };
        agent._el.addEventListener("click", () => speak());
        speak();

        currentIntervals.push(setInterval(() => agent.animate(), 3000 + Math.random() * 4000));
      }

      // Play animation on selection change
      animSelect.addEventListener("change", () => {
        if (!currentAgent || !animSelect.value) return;
        currentAgent.stop();
        currentAgent.play(animSelect.value);
      });

      // GitHub tray notification
      const ghNotification = document.getElementById("gh-notification");
      const ghTrayIcon = document.getElementById("gh-tray-icon");
      const notifCloseBtn = document.getElementById("notif-close-btn");

      // Show after a short delay
      ghNotification.style.display = "none";
      setTimeout(() => {
        ghNotification.style.display = "";
      }, 2000);

      notifCloseBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        ghNotification.style.display = "none";
      });

      ghTrayIcon.addEventListener("click", () => {
        ghNotification.style.display = ghNotification.style.display === "none" ? "" : "none";
      });

      // Taskbar clock
      function updateClock() {
        const now = new Date();
        document.getElementById("clock").textContent = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
      }
      updateClock();
      setInterval(updateClock, 30000);
    </script>
  </body>
</html>
